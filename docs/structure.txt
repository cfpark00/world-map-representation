.
├── configs
│   ├── analysis_3d_plots        # 3D visualization analysis configs
│   ├── analysis_activation_gradients  # Gradient analysis configs for token activations
│   ├── analysis_pca_timeline    # PCA timeline visualization configs
│   ├── analysis_representation  # Representation analysis configs
│   │   └── randomwalk_pretrain_no_atlantis_15ep_llr_pad
│   │       ├── 0-5              # Layer 0-5 configs
│   │       └── regions          # Regional analysis configs
│   ├── analysis_representation_higher  # Stripped representation analysis (no world map)
│   ├── data_generation
│   ├── eval                     # Checkpoint evaluation configs
│   │   ├── m1_10M_ft1          # Fine-tuning 1 (distance only) evaluation configs
│   │   └── m1_10M_ft2          # Fine-tuning 2 (multi-task) evaluation configs
│   ├── tokenizers
│   ├── training
│   ├── visualization
│   ├── atlantis_region_mapping.json
│   └── tasks.json
├── data
│   ├── datasets                 # Generated datasets
│   ├── experiments             # Training outputs
│   ├── figures
│   ├── geographic_mappings
│   ├── tokenizers
│   └── geonames-all-cities-with-a-population-1000.csv
├── docs
│   ├── findings                 # Documented discoveries and phenomena
│   ├── logs
│   │   ├── 2025-08-30
│   │   ├── 2025-08-31
│   │   ├── 2025-09-01
│   │   ├── 2025-09-02
│   │   ├── 2025-09-03
│   │   ├── 2025-09-09
│   │   ├── 2025-09-10
│   │   ├── 2025-09-12
│   │   ├── 2025-09-13
│   │   ├── 2025-09-14
│   │   ├── 2025-09-15
│   │   ├── 2025-09-16
│   │   ├── 2025-09-17
│   │   ├── 2025-09-18
│   │   ├── 2025-09-20
│   │   └── 2025-09-21
│   ├── reports
│   ├── closing_tasks.md
│   ├── repo_usage.md
│   ├── research_proposal.md
│   └── structure.txt
├── old_commits                  # Previous versions for reference
│   ├── aug31_snapshot          # Old files from August 31
│   └── b9c7d24                 # Commit b9c7d24a0e02cebe1d966d591487ef4ffd857e6e
├── scratch                      # Temporary work directory (gitignored)
├── scripts
│   ├── analysis
│   ├── analysis_representations  # Scripts for running representation analysis
│   ├── data_generation
│   │   ├── merge               # Dataset merging/combining scripts
│   │   ├── multi               # Multi-task dataset scripts
│   │   └── single_tasks        # Individual task dataset scripts
│   ├── eval                    # Checkpoint evaluation scripts
│   ├── tokenizers
│   ├── training
│   ├── utils
│   └── visualization
├── src
│   ├── analysis
│   │   ├── past                # Archived analysis scripts
│   │   ├── analyze_activation_gradients.py  # Gradient flow analysis from loss to activations
│   │   ├── analyze_representations.py  # Full-featured analysis with all visualizations
│   │   ├── analyze_representations_higher.py  # Minimal version for dynamics plot only
│   │   ├── visualize_pca_3d.py
│   │   ├── visualize_pca_3d_timeline.py    # PCA timeline animation
│   │   ├── visualize_prediction_error_3d.py
│   │   └── visualize_xy_residual_pca_3d.py  # X/Y directions + residual PCA visualization
│   ├── data_processing
│   │   ├── combine_datasets.py
│   │   ├── create_city_dataset.py
│   │   ├── create_distance_dataset.py
│   │   ├── create_randomwalk_dataset.py    # Random walk sequences
│   │   ├── create_trianglearea_dataset.py  # Triangle area calculation
│   │   ├── create_angle_dataset.py         # Angle at center city
│   │   ├── create_nearest_neighbor_dataset.py  # K nearest neighbors (deterministic for must_include)
│   │   ├── create_crossing_dataset.py      # Line segment intersection (supports must_include)
│   │   ├── create_inside_dataset.py        # Point in convex hull (supports must_include)
│   │   ├── create_center_dataset.py        # Center of mass finder (partial must_include support)
│   │   ├── create_circlecount_dataset.py   # Count cities in radius
│   │   ├── create_compass_dataset.py       # Compass direction (uses data_utils)
│   │   ├── create_perimeter_dataset.py     # Polygon perimeter (supports must_include)
│   │   ├── create_randring_dataset.py      # Random ring sampling (stochastic)
│   │   └── data_utils.py                   # Shared pair generation strategies
│   ├── eval
│   │   └── evaluate_checkpoints.py         # Checkpoint evaluation script
│   ├── training
│   │   └── train.py
│   ├── visualization
│   │   └── visualize_cities.py
│   ├── create_tokenizer.py
│   ├── evaluation.py            # Unified evaluation module (single source of truth)
│   ├── metrics.py               # Centralized task metric calculations
│   ├── representation_extractor.py
│   ├── utils.py
│   └── utils_backup.py          # Backup of utils.py
├── anything.ipynb
├── CLAUDE.md
├── pyproject.toml
├── README.md
└── uv.lock

## Key Changes (2025-09-17 12:11)
- Fixed critical evaluation bug causing ~130 error discrepancy
  - Removed double-spacing bug in evaluate_checkpoints.py
  - Fixed BOS token handling (was adding duplicate BOS tokens)

## Key Changes (2025-09-17 14:37)
- Unified all evaluation logic into src/evaluation.py (single source of truth)
  - Fixed task-specific prompt/completion splitting (rfind vs find for '=')
  - Fixed post-training eval to decode full outputs like training eval
  - Added return_details flag for memory-efficient training vs detailed post-training
- Reorganized evaluation output structure:
  - eval_config.yaml at root
  - dynamics/ for plots (renamed from summary/)
  - eval_data/ for results and detailed data
- Fixed evaluation for tasks with parameter '=' signs (center, circlecount, randring)
  - Post-training eval now matches training eval (~5 vs ~130 → ~5 vs ~6)
- Created visualize_xy_residual_pca_3d.py
  - Novel 3D visualization showing X/Y predictive directions + residual structure
  - Uses proper coordinate centering matching analyze_representations.py
  - Shows only test cities for cleaner visualization
- Fixed add_special_tokens bugs in multiple analysis scripts

## Key Changes (2025-09-16 23:43)
- Created src/metrics.py - centralized metric calculation system
  - Eliminated ~270 lines of scattered duplicate metric implementations
  - Each task type's logic now in single TaskMetric class
  - Single source of truth for parsing, calculation, and failure values
- Refactored utils.py to use centralized metrics
  - Replaced massive if-elif chains with clean API calls
  - Maintained exact backward compatibility

## Previous Changes (2025-09-16)
- Added 7 new geometry dataset generation tasks:
  - Nearest neighbor (k-nearest cities)
  - Line crossing detection (segment intersection)
  - Inside convex hull (point-in-polygon test)
  - Center of mass (closest city to centroid)
  - Circle count (cities within radius)
  - Compass direction (8-way directional output)
  - Perimeter (polygon perimeter calculation)
- Standardized dataset sizes based on unique data availability
- Created meta script create_all_geometry_datasets_pad.sh for all 11 tasks
- Fixed center_dataset.py tie-breaking (deterministically selects first)

## Previous Changes (2025-09-15)
- Fixed critical evaluation bug for angle/trianglearea tasks (was passing answer in prompt)
- Created analyze_representations_higher.py - minimal version for dynamics plots only
- Added log-scale x-axis to loss plots for better early training visualization
- Removed all DEBUG print statements from analysis scripts
- Added dist_city_last_and_comma prompt format for representation analysis

## Previous Changes (2025-09-14)
- Added 3 new dataset types: random walk, triangle area, angle
- Overhauled evaluation system with consistent error metrics
- Created multi-task training infrastructure for 4M combined dataset
- Fixed coordinate scaling issues (10x factor in distance calculations)
- Updated plotting with proper log scales and boundaries

## Previous Changes (2025-09-12)
- old_commits/ now properly organized by commit hash
- Loss masking feature added to create_distance_dataset.py
- Fixed representation analysis bug in analyze_representations.py
- Added single checkpoint analysis support